'use strict';(function(p){"object"==typeof exports&&"object"==typeof module?p(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],p):p(CodeMirror)})(function(p){function u(c,f,b){return b?0<=c.indexOf(f):0==c.lastIndexOf(f,0)}var v=p.Pos;p.registerHelper("hint","xml",function(c,f){var b=f&&f.schemaInfo,h=f&&f.quoteChar||'"';f=f&&f.matchInMiddle;if(b){var k=c.getCursor(),a=c.getTokenAt(k);a.end>k.ch&&(a.end=k.ch,a.string=a.string.slice(0,k.ch-a.start));
var l=p.innerMode(c.getMode(),a.state);if(l.mode.xmlCurrentTag){var t=[],m=!1,n=/\btag\b/.test(a.type)&&!/>$/.test(a.string),z=n&&/^\w/.test(a.string),w;if(z){var d=c.getLine(k.line).slice(Math.max(0,a.start-2),a.start);(d=/<\/$/.test(d)?"close":/<$/.test(d)?"open":null)&&(w=a.start-("close"==d?2:1))}else n&&"<"==a.string?d="open":n&&"</"==a.string&&(d="close");var x=l.mode.xmlCurrentTag(l.state);if(!n&&!x||d){if(z)var g=a.string;m=d;h=l.mode.xmlCurrentContext?l.mode.xmlCurrentContext(l.state):[];
n=(l=h.length&&h[h.length-1])&&b[l];if((h=l?n&&n.children:b["!top"])&&"close"!=d)for(c=0;c<h.length;++c)g&&!u(h[c],g,f)||t.push("<"+h[c]);else if("close"!=d)for(var e in b)!b.hasOwnProperty(e)||"!top"==e||"!attrs"==e||g&&!u(e,g,f)||t.push("<"+e);l&&(!g||"close"==d&&u(l,g,f))&&t.push("</"+l+">")}else{e=(n=x&&b[x.name])&&n.attrs;b=b["!attrs"];if(!e&&!b)return;if(!e)e=b;else if(b){d={};for(var q in b)b.hasOwnProperty(q)&&(d[q]=b[q]);for(q in e)e.hasOwnProperty(q)&&(d[q]=e[q]);e=d}if("string"==a.type||
"="==a.string){d=c.getRange(v(k.line,Math.max(0,k.ch-60)),v(k.line,"string"==a.type?a.start:a.end));b=d.match(/([^\s\u00a0=<>"']+)=$/);var r;if(!b||!e.hasOwnProperty(b[1])||!(r=e[b[1]]))return;"function"==typeof r&&(r=r.call(this,c));"string"==a.type&&(g=a.string,m=0,/['"]/.test(a.string.charAt(0))&&(h=a.string.charAt(0),g=a.string.slice(1),m++),b=a.string.length,/['"]/.test(a.string.charAt(b-1))&&(h=a.string.charAt(b-1),g=a.string.substr(m,b-2)),m&&(c=c.getLine(k.line),c.length>a.end&&c.charAt(a.end)==
h&&a.end++),m=!0);for(c=0;c<r.length;++c)g&&!u(r[c],g,f)||t.push(h+r[c]+h)}else{"attribute"==a.type&&(g=a.string,m=!0);for(var y in e)!e.hasOwnProperty(y)||g&&!u(y,g,f)||t.push(y)}}return{list:t,from:m?v(k.line,null==w?a.start:w):k,to:m?v(k.line,a.end):k}}}})});
